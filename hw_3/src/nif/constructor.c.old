#include "nif/constructor.h"

static ERL_NIF_TERM
nif_matrix_constructor(ErlNifEnv *env,
                       int argc,
                       const ERL_NIF_TERM *argv)
{
  uint rows, columns;
  enif_get_uint(env, argv[0], &rows);
  enif_get_uint(env, argv[1], &columns);
  
  la_matrix **mat_res = enif_alloc_resource(LA_MATRIX_TYPE, sizeof(la_matrix *));
  
  la_matrix *mat_ptr;
  la_result result = la_matrix_constructor(&mat_ptr, rows, columns);
  if (result != ok)
    return enif_make_atom(env, "err");

  memcpy((void *) mat_res, (void *) &mat_ptr, sizeof(la_matrix *));

  ERL_NIF_TERM term = enif_make_resource(env, mat_res);
  enif_release_resource(mat_res);

  return term;
}
